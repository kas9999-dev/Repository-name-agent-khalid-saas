<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Nashr â€“ ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:radial-gradient(circle at top,#15203a,#0b1220);color:#e6ebf2}
    .container{max-width:980px;margin:auto;padding:40px 20px}
    h1{text-align:center;margin-bottom:12px}
    .sub{text-align:center;color:#9aa4b2;margin-bottom:22px}
    .card{background:#111a2e;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:24px;margin-bottom:18px}
    label{display:block;margin-bottom:6px;font-size:14px;color:#9aa4b2}
    textarea,select{width:100%;background:#0b1220;color:#e6ebf2;border:1px solid rgba(255,255,255,.15);border-radius:10px;padding:12px;font-size:14px;margin-bottom:14px;outline:none}
    textarea{min-height:140px;resize:vertical}
    button{background:#4da3ff;color:#fff;border:none;padding:12px 16px;border-radius:12px;font-size:14px;font-weight:800;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap}
    .btnRow button{flex:1;min-width:160px}
    .output{white-space:pre-wrap;line-height:1.8;font-size:15px;background:#0b1220;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:14px;min-height:120px}
    .meta{display:flex;gap:10px;justify-content:space-between;align-items:center;margin-top:10px;color:#9aa4b2;font-size:12px;flex-wrap:wrap}
    .pill{border:1px solid rgba(255,255,255,.14);border-radius:999px;padding:6px 10px;background:rgba(255,255,255,.04)}
    footer{text-align:center;margin-top:26px;color:#9aa4b2;font-size:13px}
    a{color:#9fc7ff}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width: 900px){ .grid2{grid-template-columns:1fr} }
    .sectionTitle{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .sectionTitle strong{font-size:14px}
    .counter{font-size:12px}
    .ok{color:#7CFFB2}
    .warn{color:#FFD37C}
    .bad{color:#FF7C7C}
    .miniRow{display:flex;gap:8px;flex-wrap:wrap}
    .miniRow button{flex:0 0 auto;padding:10px 12px;font-size:13px;border-radius:10px}
    .ghost{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12)}
    .ghost:hover{background:rgba(255,255,255,.10)}
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§  Nashr â€“ ØªØ¬Ø±Ø¨Ø© Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø°ÙƒÙŠ</h1>
    <div class="sub">Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø©ØŒ Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØµØ©ØŒ ÙˆØ§Ø¶ØºØ· ØªÙˆÙ„ÙŠØ¯</div>

    <div class="card">
      <label>Ø§Ù„ÙÙƒØ±Ø© / Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹</label>
      <textarea id="text" placeholder="Ø§ÙƒØªØ¨ ÙÙƒØ±ØªÙƒ Ù‡Ù†Ø§..."></textarea>

      <label>Ø§Ù„Ù…Ù†ØµØ©</label>
      <select id="platform">
        <option value="Both">LinkedIn + X</option>
        <option value="LinkedIn">LinkedIn</option>
        <option value="X">X</option>
      </select>

      <div class="btnRow">
        <button id="runBtn" type="button">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
        <button id="copyAllBtn" class="ghost" type="button" disabled>Ù†Ø³Ø® Ø§Ù„ÙƒÙ„</button>
      </div>

      <div class="meta">
        <span class="pill">API: /api/run</span>
        <span class="pill"><a href="/health" target="_blank" rel="noopener">health</a></span>
        <span class="pill" id="status">Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ù‡Ø²</span>
        <span class="pill" id="debug">â€”</span>
      </div>
    </div>

    <div class="grid2">
      <div class="card">
        <div class="sectionTitle">
          <strong>LinkedIn</strong>
          <span class="pill" id="liState">â€”</span>
        </div>
        <div id="outLinkedIn" class="output">â€”</div>
        <div class="meta">
          <div class="miniRow">
            <button id="copyLiBtn" class="ghost" type="button" disabled>Ù†Ø³Ø® LinkedIn</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="sectionTitle">
          <strong>X</strong>
          <span class="counter pill" id="xCount">0 / 280</span>
        </div>
        <div id="outX" class="output">â€”</div>
        <div class="meta">
          <div class="miniRow">
            <button id="copyXBtn" class="ghost" type="button" disabled>Ù†Ø³Ø® X</button>
          </div>
          <span class="pill" id="xHint">â€”</span>
        </div>
      </div>
    </div>

    <footer>Nashr Â© 2025 Â· Demo Version</footer>
  </div>

<script>
  const btn = document.getElementById("runBtn");
  const copyAllBtn = document.getElementById("copyAllBtn");
  const copyLiBtn = document.getElementById("copyLiBtn");
  const copyXBtn = document.getElementById("copyXBtn");

  const status = document.getElementById("status");
  const debug = document.getElementById("debug");

  const outLinkedIn = document.getElementById("outLinkedIn");
  const outX = document.getElementById("outX");

  const xCount = document.getElementById("xCount");
  const xHint = document.getElementById("xHint");
  const liState = document.getElementById("liState");

  let lastFull = "";
  let lastLi = "";
  let lastX = "";

  btn.addEventListener("click", run);
  copyAllBtn.addEventListener("click", () => copyText(lastFull));
  copyLiBtn.addEventListener("click", () => copyText(lastLi));
  copyXBtn.addEventListener("click", () => copyText(lastX));

  function setXCounter(text){
    const n = (text || "").length;
    xCount.textContent = `${n} / 280`;

    xCount.classList.remove("ok","warn","bad");
    xHint.classList.remove("ok","warn","bad");

    if(n === 0){
      xHint.textContent = "â€”";
      return;
    }
    if(n <= 240){
      xCount.classList.add("ok");
      xHint.classList.add("ok");
      xHint.textContent = "Ù…Ù…ØªØ§Ø² âœ…";
    } else if(n <= 280){
      xCount.classList.add("warn");
      xHint.classList.add("warn");
      xHint.textContent = "Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø­Ø¯ âš ï¸";
    } else {
      xCount.classList.add("bad");
      xHint.classList.add("bad");
      xHint.textContent = "ØªØ¬Ø§ÙˆØ² 280 âŒ (Ø³ÙŠØªÙ… Ø§Ø®ØªØµØ§Ø±Ù‡ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¥Ù† ÙØ¹Ù‘Ù„Øª Ø§Ù„ÙÙ„ØªØ±)";
    }
  }

  function normalize(s){
    return String(s || "").replace(/\r/g, "").trim();
  }

  function splitOutput(full){
    // ÙŠØªÙˆÙ‚Ø¹: "LinkedIn:" ... "\n\nX:" ...
    const t = normalize(full);

    // Ø­Ø§ÙˆÙ„ Ù†Ø¨Ø­Ø« Ø¹Ù† X:
    const xIdx = t.search(/\n?X\s*:\s*\n/i);
    const liIdx = t.search(/(^|\n)LinkedIn\s*:\s*\n/i);

    let li = "";
    let x = "";

    if(liIdx !== -1 && xIdx !== -1 && xIdx > liIdx){
      li = t.slice(liIdx).replace(/(^|\n)LinkedIn\s*:\s*\n/i, "").slice(0, xIdx - liIdx).trim();
      x = t.slice(xIdx).replace(/\n?X\s*:\s*\n/i, "").trim();
      return { li, x };
    }

    // Ø¥Ø°Ø§ Ø§Ù„Ù…Ù†ØµØ© X ÙÙ‚Ø· Ù‚Ø¯ ÙŠØ±Ø¬Ø¹ Ù†Øµ ÙˆØ§Ø­Ø¯
    // Ø£Ùˆ LinkedIn ÙÙ‚Ø· ÙŠØ±Ø¬Ø¹ Ù†Øµ ÙˆØ§Ø­Ø¯
    return { li: "", x: "" , raw: t };
  }

  function render(platform, fullText){
    lastFull = normalize(fullText);

    // Ø§ÙØªØ±Ø§Ø¶ÙŠ
    outLinkedIn.innerText = "â€”";
    outX.innerText = "â€”";
    liState.textContent = "â€”";
    setXCounter("");

    lastLi = "";
    lastX = "";

    const { li, x, raw } = splitOutput(lastFull);

    if(platform === "Both"){
      lastLi = li || "";
      lastX = x || "";
      outLinkedIn.innerText = lastLi || "â€”";
      outX.innerText = lastX || "â€”";
      liState.textContent = lastLi ? "Ø¬Ø§Ù‡Ø² âœ…" : "ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯";
      setXCounter(lastX || "");
    }

    if(platform === "LinkedIn"){
      lastLi = raw || lastFull;
      outLinkedIn.innerText = lastLi || "â€”";
      outX.innerText = "â€”";
      liState.textContent = lastLi ? "Ø¬Ø§Ù‡Ø² âœ…" : "â€”";
      setXCounter("");
    }

    if(platform === "X"){
      lastX = raw || lastFull;
      outX.innerText = lastX || "â€”";
      outLinkedIn.innerText = "â€”";
      liState.textContent = "â€”";
      setXCounter(lastX || "");
    }

    // Buttons enablement
    copyAllBtn.disabled = !lastFull;
    copyLiBtn.disabled = !lastLi;
    copyXBtn.disabled = !lastX;
  }

  async function copyText(text){
    const t = normalize(text);
    if(!t) return;
    try{
      await navigator.clipboard.writeText(t);
      debug.textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…";
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = t;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      debug.textContent = "ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…";
    }
  }

  async function run(){
    const text = document.getElementById("text").value.trim();
    const platform = document.getElementById("platform").value;

    if(!text){ alert("Ø§ÙƒØªØ¨ Ø§Ù„ÙÙƒØ±Ø© Ø£ÙˆÙ„Ø§Ù‹"); return; }

    btn.disabled = true;
    status.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
    debug.textContent = "â€”";
    outLinkedIn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...";
    outX.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆÙ„ÙŠØ¯...";
    liState.textContent = "â€”";
    setXCounter("");

    copyAllBtn.disabled = true;
    copyLiBtn.disabled = true;
    copyXBtn.disabled = true;

    try{
      const res = await fetch("/api/run", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ text, platform, tone:"Ø§Ø­ØªØ±Ø§ÙÙŠØ©", audience:"Ø±ÙˆØ§Ø¯ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„" })
      });

      const data = await res.json();
      if(!res.ok || !data.ok) throw new Error(data.error || ("HTTP " + res.status));

      status.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: ØªÙ… âœ…";
      debug.textContent = "HTTP " + res.status;

      render(platform, data.output || "");
    }catch(e){
      status.textContent = "Ø§Ù„Ø­Ø§Ù„Ø©: ÙØ´Ù„ âŒ";
      debug.textContent = "Ø±Ø§Ø¬Ø¹ /health Ùˆ Logs";
      outLinkedIn.innerText = "âŒ Ø®Ø·Ø£: " + (e.message || e);
      outX.innerText = "âŒ Ø®Ø·Ø£: " + (e.message || e);
      liState.textContent = "â€”";
      setXCounter("");
    }finally{
      btn.disabled = false;
    }
  }
</script>
</body>
</html>