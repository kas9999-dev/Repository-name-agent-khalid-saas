<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nashr — App</title>

  <link rel="stylesheet" href="./styles.css" />

  <style>
    :root{
      --bg:#070b14;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.08);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --good:#46d27b;
      --warn:#ffcc66;
      --bad:#ff4d4d;
    }

    html,body{
      margin:0;
      height:100%;
      background:var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;margin-bottom:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    label{font-size:13px;color:var(--muted)}
    select,textarea,button{
      width:100%;
      background:var(--panel2);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      color:var(--text)
    }
    textarea{min-height:120px;resize:vertical}
    button.primary{background:#1f6feb;border:none}
    button.ghost{background:transparent}
    .out{white-space:pre-wrap;font-size:14px}
    .pill{font-size:12px;color:var(--muted)}
    footer{text-align:center;color:var(--muted);font-size:12px;margin:24px 0}
    .ok{color:var(--good)}
  </style>
</head>

<body>
<div class="wrap">

  <!-- Header -->
  <div class="card">
    <h2>Nashr</h2>
    <div class="pill">Demo Version • 2025</div>
  </div>

  <!-- Controls -->
  <div class="card">
    <label>الفكرة / الموضوع</label>
    <textarea id="text" placeholder="اكتب الفكرة هنا..."></textarea>

    <div class="row-4" style="margin-top:12px">
      <div>
        <label>المنصة</label>
        <select id="platform">
          <option value="linkedin+x">LinkedIn + X</option>
          <option value="linkedin">LinkedIn</option>
          <option value="x">X</option>
        </select>
      </div>

      <div>
        <label>النبرة</label>
        <select id="tone">
          <option value="professional">احترافية</option>
          <option value="bold">جريئة</option>
          <option value="friendly">ودية</option>
        </select>
      </div>

      <div>
        <label>الجمهور</label>
        <select id="audience">
          <option value="founders">رواد الأعمال</option>
          <option value="investors">مستثمرون</option>
          <option value="creators">صناع محتوى</option>
          <option value="general">عام</option>
        </select>
      </div>

      <div>
        <label>اللغة</label>
        <select id="language">
          <option value="ar">العربية</option>
          <option value="en">English</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <button class="primary" id="btn">توليد المحتوى</button>
      <button class="ghost" id="copyAll">نسخ الكل</button>
    </div>

    <div class="pill ok" id="status"></div>
  </div>

  <!-- Output -->
  <div class="card">
    <h4>X</h4>
    <div id="xOut" class="out"></div>
  </div>

  <div class="card">
    <h4>LinkedIn</h4>
    <div id="linkedinOut" class="out"></div>
  </div>

  <div class="card">
    <h4>سلسلة / ردود / ترند</h4>
    <div id="extraOut" class="out"></div>
  </div>

  <footer>Nashr © 2025 • Demo Version</footer>
</div>

<script type="module">
const btn = document.getElementById("btn");
const status = document.getElementById("status");
const xOut = document.getElementById("xOut");
const linkedinOut = document.getElementById("linkedinOut");
const extraOut = document.getElementById("extraOut");

btn.onclick = async () => {
  status.textContent = "⏳ جاري التوليد...";
  btn.disabled = true;

  const payload = {
    text: text.value.trim(),
    platform: platform.value,
    tone: tone.value,
    audience: audience.value,
    language: language.value
  };

  try {
    const res = await fetch("/api/run", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    if(!data.ok) throw new Error(data.error);

    xOut.textContent = data.output.x || "";
    linkedinOut.textContent = data.output.linkedin || "";
    extraOut.textContent =
      (data.output.series ? "Series:\n"+data.output.series+"\n\n":"") +
      (data.output.replies ? "Replies:\n"+data.output.replies+"\n\n":"") +
      (data.output.trend ? "Trend:\n"+data.output.trend:"");

    status.textContent = "✅ Done (HTTP 200)";
  } catch(e){
    status.textContent = "❌ " + e.message;
  } finally{
    btn.disabled = false;
  }
};

document.getElementById("copyAll").onclick = () => {
  navigator.clipboard.writeText(
    xOut.textContent + "\n\n" +
    linkedinOut.textContent + "\n\n" +
    extraOut.textContent
  );
};
</script>
</body>
</html>
